
Lien du drive
https://docs.google.com/document/d/1UmmZH-7tIvOsV58ONVik2No-2Wc_DakHGyOzls1chsU/edit 



-----------
- améliorer la méthode ajout panier dans la BDD pour update la qte si deja une qte
- corriger bug qte panier en connecté
- corriger erreur aux mdp



-------
DROP PROCEDURE payerCommande;

DELIMITER | 
    CREATE PROCEDURE payerCommande(_idClient int, _numCmd int)
   
        BEGIN
            DECLARE soldeClient float; DECLARE montantCmdTTC float; DECLARE etatCmd float;
            SET soldeClient = ( SELECT c.solde FROM client c WHERE c.id = _idClient ) ;
            SET montantCmdTTC = ( SELECT calcCmdTTC(cmd.num) FROM commande cmd WHERE cmd.num = _numCmd AND cmd.idClient = _idClient ) ;
            SET etatCmd = ( SELECT cmd2.idEtat FROM commande cmd2 WHERE cmd2.num = _numCmd) ;

            IF (etatCmd = 1) THEN
              IF (soldeClient > montantCmdTTC AND montantCmdTTC IS NOT NULL AND soldeClient IS NOT NULL ) THEN 
                UPDATE commande SET idEtat = 2 WHERE num = _numCmd ; 
                UPDATE client SET solde = (soldeClient-montantCmdTTC) WHERE id = _idClient ; 
              ELSE
                SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Erreur: La paiement n\'a pas été effectué.';
              END IF;
            ELSE
              SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Erreur: La commande a déjà été payé.'; 
            END IF; 
    END |
   
    END |
   
------